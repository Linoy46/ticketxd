<div class="auth-header">
  <div class="auth-logo"></div>
  <h1 class="auth-title">PROMETTE</h1>
  <span class="auth-subtitle">Restablecer contraseña</span>
</div>

<div class="card-body p-2">
  <form [formGroup]="restoreForm" (ngSubmit)="onSubmit()">
    <!-- Confirmar Contraseña -->
    <div class="form-group confirm-password-group">
      <label for="confirmPassword" class="block mb-2">Confirmar contraseña</label>
      <p-password
        id="confirmPassword"
        formControlName="confirmPassword"
        [toggleMask]="true"
        styleClass="w-full"
        [style]="{'width': '100%'}"
        [feedback]="false"
      ></p-password>
    </div>

    <!-- Campo Contraseña - Movido después para que esté encima -->
    <div class="form-group password-main-group">
      <label for="contrasena">Nueva contraseña</label>
      <div class="password-container">
        <p-password
          #passwordComponent
          id="contrasena"
          formControlName="contrasena"
          [(ngModel)]="value"
          [feedback]="true"
          [toggleMask]="true"
          styleClass="w-full"
          [appendTo]="'body'"
          [style]="{'width': '100%', 'position': 'relative', 'z-index': '9999'}"
          [inputStyleClass]="restoreForm.get('contrasena')?.invalid && restoreForm.get('contrasena')?.touched ? 'ng-invalid ng-dirty' : ''"
          autocomplete="off"
        >
          <ng-template pTemplate="header">
            <div class="font-semibold text-xm mb-4">Elige una contraseña segura</div>
          </ng-template>
          <ng-template pTemplate="content">
            <div class="px-2 py-1">
              <div class="my-2">Fortaleza de la contraseña: {{ calculateStrength(value) }}%</div>
              <p-progressBar [value]="calculateStrength(value)" [showValue]="false"
                [styleClass]="calculateStrength(value) < 40 ? 'bg-red-500' :
                             calculateStrength(value) < 80 ? 'bg-yellow-500' :
                             'bg-green-500'"
              ></p-progressBar>
            </div>
          </ng-template>
          <ng-template pTemplate="footer">
            <p-divider></p-divider>
            <ul class="pl-2 ml-2 my-0 leading-normal">
              <li class="flex items-center mb-2">
                <i [class]="restoreForm.get('contrasena')?.hasError('lowercase') ? 'pi pi-times text-red-500' : 'pi pi-check text-green-500'" class="mr-2"></i>
                <span [class]="restoreForm.get('contrasena')?.hasError('lowercase') ? 'text-red-500' : 'text-green-500'">Al menos una letra minúscula</span>
              </li>
              <li class="flex items-center mb-2">
                <i [class]="restoreForm.get('contrasena')?.hasError('uppercase') ? 'pi pi-times text-red-500' : 'pi pi-check text-green-500'" class="mr-2"></i>
                <span [class]="restoreForm.get('contrasena')?.hasError('uppercase') ? 'text-red-500' : 'text-green-500'">Al menos una letra mayúscula</span>
              </li>
              <li class="flex items-center mb-2">
                <i [class]="restoreForm.get('contrasena')?.hasError('number') ? 'pi pi-times text-red-500' : 'pi pi-check text-green-500'" class="mr-2"></i>
                <span [class]="restoreForm.get('contrasena')?.hasError('number') ? 'text-red-500' : 'text-green-500'">Al menos un número</span>
              </li>
              <li class="flex items-center">
                <i [class]="restoreForm.get('contrasena')?.hasError('minlength') ? 'pi pi-times text-red-500' : 'pi pi-check text-green-500'" class="mr-2"></i>
                <span [class]="restoreForm.get('contrasena')?.hasError('minlength') ? 'text-red-500' : 'text-green-500'">Mínimo 8 caracteres</span>
              </li>
            </ul>
          </ng-template>
        </p-password>
      </div>
    </div>

    <div class="d-grid gap-2 mt-4">
      <button
        type="submit"
        class="btn btn-primary btn-block"
        [disabled]="restoreForm.invalid"
      >
        Cambiar contraseña
      </button>
      <div class="d-flex justify-content-between mt-3">
        <a routerLink="/auth/login" class="btn btn-link p-0">Iniciar sesión</a>
      </div>
    </div>
  </form>
</div>
